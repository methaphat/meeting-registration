version: '3.8'

# ไฟล์นี้สำหรับใช้กับ Portainer Stack แบบง่าย
# ใช้เมื่อ build image แล้ว หรือใช้ pre-built image

services:
  meeting-registration:
    # วิธีที่ 1: ใช้ image ที่ build แล้ว (แนะนำ - เร็วกว่า)
    # ต้อง build image ก่อนใน Portainer → Images → Build a new image
    image: meeting-registration:latest
    
    # วิธีที่ 2: ใช้ build (ถ้าต้องการ build ใหม่)
    # Uncomment ส่วนนี้และ comment image: ข้างบน
    # build:
    #   context: /docker/meeting-registration
    #   dockerfile: /docker/meeting-registration/Dockerfile
    
    container_name: meeting-registration-app
    restart: unless-stopped
    ports:
      - "${PORT:-3030}:3030"
    environment:
      - PORT=${PORT:-3030}
      - NODE_ENV=production
      - ADMIN_PASSWORD=${ADMIN_PASSWORD:-admin123}
      - SESSION_SECRET=${SESSION_SECRET:-meeting-registration-secret-key-change-in-production}
    volumes:
      # Named volume สำหรับ SQLite database (persistent)
      - meeting-data:/app/data
    networks:
      - meeting-network
    healthcheck:
      test: ["CMD-SHELL", "wget --no-verbose --tries=1 --spider http://localhost:3030 || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    labels:
      - "com.docker.compose.project=meeting-registration"
      - "traefik.enable=false"

volumes:
  meeting-data:
    driver: local
    name: meeting-registration-data

networks:
  meeting-network:
    driver: bridge
    name: meeting-registration-network

